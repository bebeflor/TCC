<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relógios - Vitaliz</title>
    <link rel="stylesheet" href="relogios.css">
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <h1 class="logo">Vitaliz</h1>
        <nav class="sidebar-nav">
            <a href="cadastro.html">Cadastro</a>
            <a href="inicio.html">Início</a>
            <a href="oculos-fem.html">Moda Feminina</a>
            <a href="oculos-masc.html">Moda Masculina</a>
            <a href="oculos-infantil.html">Moda Infantil</a>
            <a href="consulta.html">Exame de vista</a>
            <a href="relogios.html">Relógios</a>
            <a href="contato.html">Contato</a>
        </nav>
    </header>

    <main>
        <section class="relogios">
            <h2>Nossos Relógios</h2>

            <div class="carousel-wrapper">
                <button class="arrow left" id="prevBtn">&#10094;</button>

                <div class="carousel" id="carousel">
                    <div class="card"><img src="img/relogio1.png" alt="Technos - R$ 490,00" loading="lazy" decoding="async" width="300" height="300" style="width:100%;height:auto;" /><p>Condor dourado- R$ 590,00</p></div>
                    <div class="card"><img src="img/relogio2.png" alt="Azul Mormaii - R$ 479,00" loading="lazy" decoding="async" width="300" height="300" style="width:100%;height:auto;" /><p> Mormaii preto- R$ 479,00</p></div>
                    <div class="card"><img src="img/relogio3.png" alt="Condor Feminino - R$ 459,00" loading="lazy" decoding="async" width="300" height="300" style="width:100%;height:auto;" /><p>Mormaii dourado - R$ 699,90</p></div>
                    <div class="card"><img src="img/relogio4.png" alt="Smartwatch - R$ 899,99" loading="lazy" decoding="async" width="300" height="300" style="width:100%;height:auto;" /><p>Technos unisex- R$ 599,99</p></div>
                    <div class="card"><img src="img/relogio5.png" alt="Technos Masculino - R$ 759,90" loading="lazy" decoding="async" width="300" height="300" style="width:100%;height:auto;" /><p>Mormaii masculio azul- R$ 759,90</p></div>
                    <div class="card"><img src="img/relogio7.jpeg" alt="Condor Masculino - R$ 650,00" loading="lazy" decoding="async" width="300" height="300" style="width:100%;height:auto;" /><p>Apple watch unisex - R$ 1.299,00</p></div>
                    <div class="card"><img src="img/relogio6.png" alt="Euro Feminino - R$ 850,00" loading="lazy" decoding="async" width="300" height="300" style="width:100%;height:auto;" /><p>Condor feminino - R$ 850,00</p></div>
                    <div class="card"><img src="img/relogio9.jpeg" alt="Mormaii Dourado - R$ 610,00" loading="lazy" decoding="async" width="300" height="300" style="width:100%;height:auto;" /><p>  Euro feminino com pulseira - R$ 799,00</p></div>
                    <div class="card"><img src="img/relogio10.jpeg" alt="Mormaii Dourado - R$ 610,00" loading="lazy" decoding="async" width="300" height="300" style="width:100%;height:auto;" /><p>  Mormaii azul masculino - R$ 580,00</p></div>
                    <div class="card"><img src="img/relogio11.jpeg" alt="Mormaii Dourado - R$ 610,00" loading="lazy" decoding="async" width="300" height="300" style="width:100%;height:auto;" /><p>  Euro masculino - R$ 677,90</p></div>
                    <div class="card"><img src="img/relogio8.jpeg" alt="Mormaii Dourado - R$ 610,00" loading="lazy" decoding="async" width="300" height="300" style="width:100%;height:auto;" /><p>  Condor masculino - R$ 659,90</p></div>
                    <div class="card"><img src="img/relogio12.jpeg" alt="Mormaii Dourado - R$ 610,00" loading="lazy" decoding="async" width="300" height="300" style="width:100%;height:auto;" /><p>  Technos feminino - R$ 550,00</p></div>
                </div>


                <button class="arrow right" id="nextBtn">&#10095;</button>

                <div class="carousel-arrows-mobile">
                    <button class="arrow left mobile-arrow" id="prevBtnMobile">&#10094;</button>
                    <button class="arrow right mobile-arrow" id="nextBtnMobile">&#10095;</button>
                </div>
            </div>
            <div class="carousel-indicators" id="carouselIndicators"></div>
        </section>
    </main>

    <footer>
        © 2025 Ótica Vitaliz - Todos os direitos reservados
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const carousel = document.getElementById('carousel');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const indicatorsContainer = document.getElementById('carouselIndicators');

            // Se você adicionou as setas mobile no HTML
            const prevBtnMobile = document.getElementById('prevBtnMobile');
            const nextBtnMobile = document.getElementById('nextBtnMobile');

            // Pega todos os cards dentro do carrossel
            const cards = Array.from(carousel.querySelectorAll('.card'));

            // Habilita arrastar o carrossel com pointer events (melhora UX em touch/desktop)
            let isDown = false;
            let startX;
            let scrollLeftStart;
            // garante que o carrossel permita controle por ponteiro
            carousel.style.touchAction = 'pan-y';
            carousel.addEventListener('pointerdown', (e) => {
                isDown = true;
                carousel.setPointerCapture(e.pointerId);
                startX = e.clientX;
                scrollLeftStart = carousel.scrollLeft;
                carousel.classList.add('dragging');
            });
            carousel.addEventListener('pointermove', (e) => {
                if (!isDown) return;
                const x = e.clientX;
                const walk = (startX - x); // positivo = scroll right
                carousel.scrollLeft = scrollLeftStart + walk;
            });
            carousel.addEventListener('pointerup', (e) => {
                isDown = false;
                try { carousel.releasePointerCapture(e.pointerId); } catch (err) {}
                carousel.classList.remove('dragging');
            });
            carousel.addEventListener('pointercancel', () => { isDown = false; carousel.classList.remove('dragging'); });

            // Adiciona botão Fazer pedido a cada card
            cards.forEach(card => {
                const title = card.querySelector('p') ? card.querySelector('p').innerText : '';
                // tenta extrair preço do texto do parágrafo
                const priceMatch = title.match(/R\$\s?\d+[\d\.,]*/);
                const price = priceMatch ? priceMatch[0] : '';
                const produtoText = title.replace(price, '').trim();
                // criar botão (usando <button> para facilitar comportamento)
                const btn = document.createElement('button');
                btn.className = 'pedido-btn';
                btn.type = 'button';
                btn.textContent = 'Fazer pedido';
                // ao clicar, adiciona ao sessionStorage e redireciona para pedido.html
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    try {
                        const key = 'pedido_items';
                        const existing = JSON.parse(sessionStorage.getItem(key) || '[]');
                        existing.push({ produto: produtoText, preco: price });
                        sessionStorage.setItem(key, JSON.stringify(existing));
                    } catch (err) {
                        // fallback: usar localStorage se sessionStorage falhar
                        const key = 'pedido_items';
                        const existing = JSON.parse(localStorage.getItem(key) || '[]');
                        existing.push({ produto: produtoText, preco: price });
                        localStorage.setItem(key, JSON.stringify(existing));
                    }
                    // redireciona para a página de pedido onde as observações serão preenchidas
                    window.location.href = 'pedido.html';
                });
                card.appendChild(btn);
            });

            // Função para atualizar a visibilidade das setas e dos indicadores
            function updateCarouselState() {
                const carouselScrollLeft = carousel.scrollLeft;
                const carouselScrollWidth = carousel.scrollWidth;
                const carouselClientWidth = carousel.clientWidth;

                // Desabilita a seta "anterior" se estiver no começo
                prevBtn.disabled = carouselScrollLeft === 0;
                if (prevBtnMobile) prevBtnMobile.disabled = carouselScrollLeft === 0; // Para mobile

                // Desabilita a seta "próximo" se estiver no final
                // Usa uma pequena margem de erro para evitar problemas de arredondamento
                nextBtn.disabled = (carouselScrollLeft + carouselClientWidth) >= (carouselScrollWidth - 5);
                if (nextBtnMobile) nextBtnMobile.disabled = (carouselScrollLeft + carouselClientWidth) >= (carouselScrollWidth - 5); // Para mobile

                // Atualiza os indicadores
                updateIndicators();
            }

            // Função para calcular o quanto scrollar por clique
            function getScrollAmount() {
                // Tenta encontrar o primeiro card para obter sua largura + gap
                if (cards.length > 0) {
                    const cardWidth = cards[0].offsetWidth;
                    const computedStyle = window.getComputedStyle(carousel);
                    const gap = parseFloat(computedStyle.gap); // Pega o valor de 'gap' do CSS
                    return cardWidth + gap;
                }
                return carousel.offsetWidth; // Fallback se não encontrar cards
            }

            // Event Listener para o botão "Anterior"
            prevBtn.addEventListener('click', () => {
                const scrollAmount = getScrollAmount();
                carousel.scrollLeft -= scrollAmount;
                // A atualização do estado é feita pelo evento 'scroll' do carrossel para garantir sincronia
            });

            // Event Listener para o botão "Próximo"
            nextBtn.addEventListener('click', () => {
                const scrollAmount = getScrollAmount();
                carousel.scrollLeft += scrollAmount;
                // A atualização do estado é feita pelo evento 'scroll' do carrossel para garantir sincronia
            });

            // Se houver setas mobile, adicione os event listeners para elas também
            if (prevBtnMobile && nextBtnMobile) {
                prevBtnMobile.addEventListener('click', () => {
                    const scrollAmount = getScrollAmount();
                    carousel.scrollLeft -= scrollAmount;
                    // A atualização do estado é feita pelo evento 'scroll' do carrossel para garantir sincronia
                });

                nextBtnMobile.addEventListener('click', () => {
                    const scrollAmount = getScrollAmount();
                    carousel.scrollLeft += scrollAmount;
                    // A atualização do estado é feita pelo evento 'scroll' do carrossel para garantir sincronia
                });
            }

            // Lógica para os indicadores (as "bolinhas")
            function createIndicators() {
                indicatorsContainer.innerHTML = ''; // Limpa os indicadores existentes
                // Verifica se há cards antes de tentar calcular cardsPerView
                if (cards.length === 0) return; 

                // Garante que o getScrollAmount seja válido antes de usar
                const scrollAmountBase = getScrollAmount();
                if (scrollAmountBase === 0) return; // Evita divisão por zero

                const cardsPerView = Math.floor(carousel.clientWidth / scrollAmountBase);
                
                // Calcula o número de "páginas" de cards
                const numPages = Math.ceil(cards.length / cardsPerView);

                for (let i = 0; i < numPages; i++) {
                    const indicator = document.createElement('button');
                    indicator.classList.add('indicator');
                    indicator.dataset.page = i; // Armazena a página que o indicador representa
                    indicatorsContainer.appendChild(indicator);

                    indicator.addEventListener('click', (event) => {
                        const pageIndex = parseInt(event.target.dataset.page);
                        // Calcula a posição de scroll para a página clicada
                        carousel.scrollTo({
                            left: pageIndex * scrollAmountBase * cardsPerView,
                            behavior: 'smooth'
                        });
                        // A atualização do estado é feita pelo evento 'scroll' do carrossel
                    });
                }
            }

            function updateIndicators() {
                // Se o container de indicadores não tiver filhos, recrie-os
                if (!indicatorsContainer.children.length && cards.length > 0) { // Adicionado cards.length > 0 para evitar criar indicadores vazios
                    createIndicators();
                }

                if (cards.length === 0) return; // Se não houver cards, não atualiza indicadores

                const scrollAmountBase = getScrollAmount();
                if (scrollAmountBase === 0) return;

                const cardsPerView = Math.floor(carousel.clientWidth / scrollAmountBase);
                // Calcula a página atual baseada na posição do scroll
                // Adiciona uma pequena margem de erro para melhorar a detecção da página
                const currentPage = Math.floor((carousel.scrollLeft + (scrollAmountBase / 2)) / (scrollAmountBase * cardsPerView));
                
                Array.from(indicatorsContainer.children).forEach((indicator, index) => {
                    if (index === currentPage) {
                        indicator.classList.add('active');
                    } else {
                        indicator.classList.remove('active');
                    }
                });
            }

            // Atualiza o estado do carrossel quando ele scrolla (manual ou por seta)
            carousel.addEventListener('scroll', () => {
                updateCarouselState();
            });

            // Inicializa o carrossel e os indicadores ao carregar a página e redimensionar
            window.addEventListener('resize', () => {
                createIndicators(); // Recria indicadores para ajustar-se à nova largura
                updateCarouselState();
            });

            // Chama a função inicial ao carregar a página
            createIndicators(); // Cria os indicadores pela primeira vez
            updateCarouselState(); // Define o estado inicial das setas e indicadores
        });
     </script>
 </body>
 </html>